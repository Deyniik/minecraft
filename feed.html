<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deynik Minecraft - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif;
        }

        body {
            background-color: #0f0f11;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            padding: 2rem 1rem;
        }

        .container {
            max-width: 1400px;
            width: 100%;
            display: flex;
            gap: 2rem;
        }

        :root {
            --bg-body: #0f0f11;
            --bg-raised: #1c1c1f;
            --bg-button: #2c2c30;
            --bg-button-hover: #3a3a40;
            --bg-selected: #3b3b45;
            --text-contrast: #ffffff;
            --text-primary: #e0e0e0;
            --text-secondary: #a0a0a8;
            --text-brand: #fbbf24;
            --bg-brand: rgba(251, 191, 36, 0.15);
            --border-subtle: #2c2c32;
            --card-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
            
            --color-mod: #fbbf24;
            --color-shader: #a78bfa;
            --color-resourcepack: #60a5fa;
            --color-modpack: #f87171;
            --color-plugin: #34d399;
            --color-datapack: #f472b6;
        }

        .sidebar {
            width: 260px;
            flex-shrink: 0;
            background-color: var(--bg-raised);
            border-radius: 1rem;
            border: 1px solid var(--border-subtle);
            padding: 1.5rem 1rem;
            height: fit-content;
            position: sticky;
            top: 2rem;
        }

        .sidebar-logo {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--text-contrast);
            margin-bottom: 2rem;
            padding-left: 0.5rem;
            cursor: pointer;
        }

        .sidebar-logo span {
            color: var(--text-brand);
        }

        .sidebar-menu {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-bottom: 2rem;
        }

        .sidebar-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem 1rem;
            border-radius: 0.75rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            font-size: 1rem;
            font-weight: 500;
        }

        .sidebar-item:hover {
            background-color: var(--bg-button);
            color: var(--text-contrast);
        }

        .sidebar-item.active {
            background-color: var(--bg-brand);
            color: var(--text-brand);
        }

        .sidebar-item svg {
            width: 1.5rem;
            height: 1.5rem;
            stroke: currentColor;
            fill: none;
        }

        .main-content {
            flex: 1;
            min-width: 0;
            max-width: 550px;
            margin: 0 auto;
        }

        .feed-header {
            margin-bottom: 2rem;
        }

        .feed-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-contrast);
        }

        .feed-title span {
            color: var(--text-brand);
        }

        .feed {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .feed-post {
            background-color: var(--bg-raised);
            border-radius: 1rem;
            border: 1px solid var(--border-subtle);
            overflow: hidden;
            transition: all 0.2s;
            cursor: pointer;
            width: 100%;
        }

        .feed-post:hover {
            transform: translateY(-2px);
            box-shadow: var(--card-shadow);
            border-color: var(--text-brand);
        }

        .post-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--border-subtle);
        }

        .post-icon {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background-color: var(--bg-button);
            object-fit: cover;
            border: 2px solid var(--text-brand);
        }

        .post-info {
            flex: 1;
        }

        .post-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-contrast);
            line-height: 1.3;
        }

        .post-title-row {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .post-type {
            display: inline-flex;
            align-items: center;
            padding: 0.15rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .post-type.mod { background-color: var(--color-mod); color: #000; }
        .post-type.shader { background-color: var(--color-shader); color: #000; }
        .post-type.resourcepack { background-color: var(--color-resourcepack); color: #000; }
        .post-type.modpack { background-color: var(--color-modpack); color: #000; }
        .post-type.plugin { background-color: var(--color-plugin); color: #000; }
        .post-type.datapack { background-color: var(--color-datapack); color: #000; }

        .post-author {
            color: var(--text-secondary);
            font-size: 0.85rem;
            margin-top: 0.1rem;
        }

        /* –ö–∞—Ä—É—Å–µ–ª—å */
        .carousel-container {
            position: relative;
            width: 100%;
            background-color: #000;
            border-bottom: 1px solid var(--border-subtle);
            user-select: none;
        }

        .carousel-track {
            display: flex;
            scroll-snap-type: x mandatory;
            overflow-x: auto;
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE/Edge */
        }

        .carousel-track::-webkit-scrollbar {
            display: none; /* Chrome/Safari */
        }

        .carousel-slide {
            flex: 0 0 100%;
            scroll-snap-align: start;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #000;
        }

        .carousel-slide img {
            width: 100%;
            display: block;
            max-height: 70vh;
            object-fit: contain;
            cursor: pointer;
        }

        .carousel-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 10;
            transition: all 0.2s;
            backdrop-filter: blur(4px);
        }

        .carousel-btn:hover {
            background-color: rgba(0, 0, 0, 0.8);
            border-color: var(--text-brand);
        }

        .carousel-btn.prev {
            left: 12px;
        }

        .carousel-btn.next {
            right: 12px;
        }

        .carousel-dots {
            position: absolute;
            bottom: 12px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 6px;
            z-index: 10;
            background-color: rgba(0, 0, 0, 0.4);
            padding: 4px 10px;
            border-radius: 20px;
            backdrop-filter: blur(2px);
        }

        .carousel-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.5);
            transition: all 0.2s;
            cursor: pointer;
        }

        .carousel-dot.active {
            background-color: var(--text-brand);
            width: 16px;
            border-radius: 10px;
        }

        .post-image-static {
            width: 100%;
            display: block;
            max-height: 70vh;
            object-fit: contain;
            background-color: #000;
            border-bottom: 1px solid var(--border-subtle);
            cursor: pointer;
        }

        .post-actions {
            display: flex;
            gap: 1rem;
            padding: 0.75rem 1rem 1rem 1rem;
            border-top: 1px solid var(--border-subtle);
        }

        .action-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1rem;
            transition: all 0.2s;
        }

        .action-btn:hover {
            color: var(--text-brand);
        }

        .action-btn svg {
            width: 1.5rem;
            height: 1.5rem;
            stroke: currentColor;
            fill: none;
            transition: all 0.2s;
        }

        .action-btn.liked svg {
            fill: var(--text-brand);
            stroke: var(--text-brand);
        }

        .likes-count {
            font-weight: 600;
            color: var(--text-contrast);
        }

        .post-body {
            padding: 1rem 1rem 0.5rem 1rem;
        }

        .post-description {
            color: var(--text-primary);
            font-size: 0.95rem;
            line-height: 1.5;
            margin-bottom: 0.75rem;
        }

        .post-categories {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .category-tag {
            background-color: var(--bg-button);
            border: 1px solid var(--border-subtle);
            border-radius: 9999px;
            padding: 0.2rem 0.6rem;
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .post-date {
            color: var(--text-secondary);
            font-size: 0.8rem;
            text-transform: uppercase;
        }

        /* –ó–∞–≥—Ä—É–∑–∫–∞ —Å –Ω–æ–≤—ã–º —Ç–µ–∫—Å—Ç–æ–º */
        .loading {
            text-align: center;
            padding: 2.5rem;
            font-size: 1.2rem;
            color: var(--text-secondary);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
        }

        .loading-spinner {
            display: inline-block;
            width: 44px;
            height: 44px;
            border: 3px solid var(--border-subtle);
            border-top-color: var(--text-brand);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .friendly-text {
            color: var(--text-brand);
            font-weight: 500;
            letter-spacing: 0.3px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.95);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            max-width: 90vw;
            max-height: 90vh;
        }

        .modal-content img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .modal-close {
            position: absolute;
            top: 1rem;
            right: 2rem;
            color: white;
            font-size: 3rem;
            cursor: pointer;
            z-index: 1010;
        }
    </style>
</head>
<body>
    <div class="modal" id="galleryModal" onclick="closeModal()">
        <span class="modal-close">&times;</span>
        <div class="modal-content">
            <img id="modalImage" src="" alt="">
        </div>
    </div>

    <div class="container">
        <div class="sidebar">
            <div class="sidebar-logo" onclick="window.location.href='/minecraft/'">Deynik <span>Minecraft</span></div>
            <div class="sidebar-menu">
                <button class="sidebar-item" onclick="window.location.href='/minecraft/'">
                    <svg viewBox="0 0 24 24"><path d="M3 10.5L12 3l9 7.5v9a1.5 1.5 0 0 1-1.5 1.5h-15A1.5 1.5 0 0 1 3 19.5v-9z"/><path d="M9 21v-6h6v6"/></svg>
                    –ì–ª–∞–≤–Ω–∞—è
                </button>
                <button class="sidebar-item active" onclick="window.location.href='/minecraft/feed.html'">
                    <svg viewBox="0 0 24 24"><path d="M22 6.5L12 2 2 6.5M22 6.5L12 11 2 6.5M22 6.5V17M2 6.5V17M12 11v9"/><path d="M7 15l5 3 5-3"/></svg>
                    –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
                </button>
            </div>
            <div class="sidebar-menu">
                <button class="sidebar-item" onclick="window.location.href='/minecraft/?#mod'">
                    <svg viewBox="0 0 24 24"><path d="M20 7h-4.5L15 4H9L8.5 7H4v2h16V7z"/><rect x="4" y="9" width="16" height="10" rx="1"/><circle cx="8" cy="13" r="1"/><circle cx="16" cy="13" r="1"/></svg>
                    –ú–æ–¥—ã
                </button>
                <button class="sidebar-item" onclick="window.location.href='/minecraft/?#shader'">
                    <svg viewBox="0 0 24 24"><path d="M12 3v1M5 8h1M18 8h1M8 21h8M12 8v8"/><circle cx="12" cy="15" r="3"/><path d="M8 11L5 8M16 11l3-3"/></svg>
                    –®–µ–π–¥–µ—Ä—ã
                </button>
                <button class="sidebar-item" onclick="window.location.href='/minecraft/?#resourcepack'">
                    <svg viewBox="0 0 24 24"><path d="M4 4h16v16H4z"/><path d="M9 9l6 6M15 9l-6 6"/></svg>
                    –†–µ—Å—É—Ä—Å–ø–∞–∫–∏
                </button>
                <button class="sidebar-item" onclick="window.location.href='/minecraft/?#modpack'">
                    <svg viewBox="0 0 24 24"><path d="M4 4h16v2H4z"/><rect x="4" y="8" width="16" height="12" rx="1"/><path d="M10 12l2 2 4-4"/></svg>
                    –°–±–æ—Ä–∫–∏
                </button>
                <button class="sidebar-item" onclick="window.location.href='/minecraft/?#plugin'">
                    <svg viewBox="0 0 24 24"><path d="M20 12v4a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-4"/><rect x="4" y="4" width="16" height="8" rx="1"/><circle cx="12" cy="12" r="2"/></svg>
                    –ü–ª–∞–≥–∏–Ω—ã
                </button>
                <button class="sidebar-item" onclick="window.location.href='/minecraft/?#datapack'">
                    <svg viewBox="0 0 24 24"><path d="M4 4h16v16H4z"/><path d="M8 8h8v8H8z"/><path d="M12 12l2-2-2-2"/></svg>
                    –î–∞—Ç–∞–ø–∞–∫–∏
                </button>
            </div>
        </div>

        <div class="main-content">
            <div class="feed-header">
                <h1 class="feed-title">–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ <span>–¥–ª—è –≤–∞—Å</span></h1>
            </div>
            <div class="feed" id="feed">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <div class="friendly-text">–°–æ–±–∏—Ä–∞–µ–º –¥–ª—è –≤–∞—Å –ø–æ–¥–±–æ—Ä–∫—É ‚ú®</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'https://api.modrinth.com/v2';
        const TRANSLATE_API = 'https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=ru&dt=t&q=';
        const POSTS_PER_PAGE = 5;

        const projectTypes = ['mod', 'shader', 'resourcepack', 'modpack', 'plugin', 'datapack'];
        const projectTypeNames = {
            'mod': '–ú–æ–¥', 'shader': '–®–µ–π–¥–µ—Ä', 'resourcepack': '–†–µ—Å—É—Ä—Å–ø–∞–∫',
            'modpack': '–°–±–æ—Ä–∫–∞', 'plugin': '–ü–ª–∞–≥–∏–Ω', 'datapack': '–î–∞—Ç–∞–ø–∞–∫'
        };

        let feedPosts = [];
        let cachedTranslations = new Map();
        let isLoading = false;
        let hasMore = true;
        let currentPage = 0;

        // –î–ª—è –∫–∞—Ä—É—Å–µ–ª–∏: —Ñ—É–Ω–∫—Ü–∏—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∫–ª–∏–∫–∞, —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –ø–æ –ø–æ—Å—Ç—É
        window.stopPropagation = function(e) {
            e.stopPropagation();
        };

        window.openModal = function(src) {
            document.getElementById('modalImage').src = src;
            document.getElementById('galleryModal').classList.add('show');
        };

        window.closeModal = function() {
            document.getElementById('galleryModal').classList.remove('show');
        };

        // –ù–∞–≤–∏–≥–∞—Ü–∏—è –∫–∞—Ä—É—Å–µ–ª–∏
        window.scrollCarousel = function(container, direction) {
            const track = container.querySelector('.carousel-track');
            if (!track) return;
            const slideWidth = track.clientWidth;
            track.scrollBy({ left: direction * slideWidth, behavior: 'smooth' });
        };

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ dots –ø—Ä–∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–µ
        function setupCarousel(container) {
            const track = container.querySelector('.carousel-track');
            const dots = container.querySelectorAll('.carousel-dot');
            if (!track || dots.length === 0) return;

            const updateDots = () => {
                const scrollLeft = track.scrollLeft;
                const slideWidth = track.clientWidth;
                const activeIndex = Math.round(scrollLeft / slideWidth);
                dots.forEach((dot, idx) => {
                    dot.classList.toggle('active', idx === activeIndex);
                });
            };

            track.addEventListener('scroll', updateDots);
            track.addEventListener('scrollend', updateDots); // —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä
            updateDots();
        }

        async function translateText(text) {
            if (!text || text.length < 20) return text;
            if (cachedTranslations.has(text)) return cachedTranslations.get(text);
            try {
                const response = await fetch(TRANSLATE_API + encodeURIComponent(text));
                const data = await response.json();
                const translated = data[0][0][0];
                cachedTranslations.set(text, translated);
                return translated;
            } catch (error) {
                console.warn('–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–≤–æ–¥–∞:', error);
                return text;
            }
        }

        function formatNumber(num) {
            if (!num) return '0';
            if (num >= 1_000_000) return (num / 1_000_000).toFixed(1) + 'M';
            if (num >= 1_000) return (num / 1_000).toFixed(1) + 'k';
            return num.toString();
        }

        function formatRelativeDate(dateString) {
            if (!dateString) return '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
            const date = new Date(dateString);
            const now = new Date();
            const diffTime = Math.abs(now - date);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            if (diffDays < 7) return `${diffDays} ${['–¥–µ–Ω—å', '–¥–Ω—è', '–¥–Ω–µ–π'][getWordIndex(diffDays)]} –Ω–∞–∑–∞–¥`;
            if (diffDays < 30) return `${Math.floor(diffDays/7)} ${['–Ω–µ–¥–µ–ª—é', '–Ω–µ–¥–µ–ª–∏', '–Ω–µ–¥–µ–ª—å'][getWordIndex(Math.floor(diffDays/7))]} –Ω–∞–∑–∞–¥`;
            if (diffDays < 365) return `${Math.floor(diffDays/30)} ${['–º–µ—Å—è—Ü', '–º–µ—Å—è—Ü–∞', '–º–µ—Å—è—Ü–µ–≤'][getWordIndex(Math.floor(diffDays/30))]} –Ω–∞–∑–∞–¥`;
            return `${Math.floor(diffDays/365)} ${['–≥–æ–¥', '–≥–æ–¥–∞', '–ª–µ—Ç'][getWordIndex(Math.floor(diffDays/365))]} –Ω–∞–∑–∞–¥`;
        }
        function getWordIndex(n) { return (n%10==1 && n%100!=11) ? 0 : (n%10>=2 && n%10<=4 && (n%100<10 || n%100>=20)) ? 1 : 2; }

        function getRandomGalleryImage(project) {
            if (project.gallery && project.gallery.length > 0) {
                return project.gallery.map(g => g.url);
            }
            return null;
        }

        window.toggleLike = function(button, postId) {
            button.classList.toggle('liked');
            const likesSpan = button.querySelector('.likes-count');
            let likes = parseInt(likesSpan.textContent.replace(/[^0-9]/g, ''));
            if (button.classList.contains('liked')) {
                likes++;
                localStorage.setItem(`like_${postId}`, 'true');
            } else {
                likes--;
                localStorage.removeItem(`like_${postId}`);
            }
            likesSpan.textContent = formatNumber(likes);
        };

        async function loadMorePosts() {
            if (isLoading || !hasMore) return;
            isLoading = true;
            const feedEl = document.getElementById('feed');

            // –ó–∞–º–µ–Ω—è–µ–º —Å—Ç–∞—Ç–∏—á–µ—Å–∫—É—é –∑–∞–≥–ª—É—à–∫—É –∏–ª–∏ –¥–æ–±–∞–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
            if (currentPage === 0) {
                feedEl.innerHTML = '<div class="loading" id="loading-more"><div class="loading-spinner"></div><div class="friendly-text">–°–æ–±–∏—Ä–∞–µ–º –¥–ª—è –≤–∞—Å –ø–æ–¥–±–æ—Ä–∫—É ‚ú®</div></div>';
            } else {
                const loadingDiv = document.createElement('div');
                loadingDiv.className = 'loading';
                loadingDiv.id = 'loading-more';
                loadingDiv.innerHTML = '<div class="loading-spinner"></div><div class="friendly-text">–ò–∑—É—á–∞–µ–º –Ω–æ–≤—ã–µ –ø—Ä–æ–µ–∫—Ç—ã üîç</div>';
                feedEl.appendChild(loadingDiv);
            }

            try {
                const promises = [];
                for (let i = 0; i < POSTS_PER_PAGE; i++) {
                    const randomType = projectTypes[Math.floor(Math.random() * projectTypes.length)];
                    const randomOffset = Math.floor(Math.random() * 5000);
                    const url = `${API_BASE}/search?limit=1&offset=${randomOffset}&index=newest&facets=${encodeURIComponent(JSON.stringify([[`project_type:${randomType}`]]))}`;
                    promises.push(
                        fetch(url).then(res => res.json()).then(async data => {
                            if (data.hits && data.hits.length > 0) {
                                const project = data.hits[0];
                                const projectRes = await fetch(`${API_BASE}/project/${project.slug}`);
                                const fullProject = await projectRes.json();
                                return { ...project, fullData: fullProject };
                            }
                            return null;
                        })
                    );
                }

                let results = await Promise.all(promises);
                let validPosts = results.filter(p => p !== null);
                validPosts = shuffleArray(validPosts);

                // –ü–µ—Ä–µ–≤–æ–¥ –æ–ø–∏—Å–∞–Ω–∏–π
                const translatePromises = validPosts.map(p => p.description && !cachedTranslations.has(p.description) ? translateText(p.description) : Promise.resolve());
                await Promise.all(translatePromises);

                // –£–±–∏—Ä–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
                const loadingMore = document.getElementById('loading-more');
                if (loadingMore) loadingMore.remove();

                if (validPosts.length === 0) {
                    hasMore = false;
                } else {
                    renderNewPosts(validPosts);
                    feedPosts.push(...validPosts);
                    currentPage++;
                }

                // –ï—Å–ª–∏ –∑–∞–≥—Ä—É–∑–∏–ª–∏ –º–µ–Ω—å—à–µ —á–µ–º –∑–∞–ø—Ä–∞—à–∏–≤–∞–ª–∏, –≤–æ–∑–º–æ–∂–Ω–æ, –±–æ–ª—å—à–µ –Ω–µ—Ç, –Ω–æ –¥–∞–¥–∏–º –µ—â—ë —à–∞–Ω—Å
                if (validPosts.length < POSTS_PER_PAGE) {
                    // –Ω–µ –æ—Ç–∫–ª—é—á–∞–µ–º hasMore —Å—Ä–∞–∑—É, –ø–æ—Ç–æ–º—É —á—Ç–æ —ç—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–ª—É—á–∞–π–Ω–æ—Å—Ç—å
                    // –ø—Ä–æ—Å—Ç–æ —É–º–µ–Ω—å—à–∏–º –ª–∏–º–∏—Ç –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ä–∞–∑–∞
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', error);
                const loadingMore = document.getElementById('loading-more');
                if (loadingMore) {
                    loadingMore.innerHTML = '<div class="friendly-text">‚ùå –ù–µ—É–¥–∞—á–∞, –ø—Ä–æ–±—É–µ–º —Å–Ω–æ–≤–∞...</div>';
                    setTimeout(() => loadingMore.remove(), 1500);
                }
            } finally {
                isLoading = false;
            }
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function getDescription(project) {
            const cached = cachedTranslations.get(project.description);
            return cached || project.description || '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è';
        }

        function isLiked(postId) {
            return localStorage.getItem(`like_${postId}`) === 'true';
        }

        function renderNewPosts(posts) {
            const feedEl = document.getElementById('feed');
            let html = '';

            for (const post of posts) {
                const description = getDescription(post);
                const iconUrl = post.icon_url || 'https://via.placeholder.com/48/2c2c30/a0a0a8?text=Mod';
                const galleryImages = getRandomGalleryImage(post.fullData);
                const typeName = projectTypeNames[post.project_type] || '–ü—Ä–æ–µ–∫—Ç';
                const postId = `${post.project_type}_${post.slug}`;
                const liked = isLiked(postId);

                // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±–ª–æ–∫–∞ —Å –∫–∞—Ä—É—Å–µ–ª—å—é –∏–ª–∏ —Å—Ç–∞—Ç–∏—á–Ω–æ–π –∫–∞—Ä—Ç–∏–Ω–∫–æ–π
                let mediaHtml = '';
                if (galleryImages && galleryImages.length > 1) {
                    const slidesHtml = galleryImages.map(img => 
                        `<div class="carousel-slide"><img src="${img}" onclick="event.stopPropagation(); openModal('${img}')" loading="lazy"></div>`
                    ).join('');
                    const dotsHtml = galleryImages.map((_, idx) => 
                        `<span class="carousel-dot" onclick="event.stopPropagation(); document.querySelector('#carousel-${postId} .carousel-track').scrollTo({ left: ${idx} * document.querySelector('#carousel-${postId} .carousel-track').clientWidth, behavior: 'smooth' })"></span>`
                    ).join('');

                    mediaHtml = `
                        <div class="carousel-container" id="carousel-${postId}" onclick="event.stopPropagation()">
                            <div class="carousel-track">${slidesHtml}</div>
                            <div class="carousel-btn prev" onclick="event.stopPropagation(); scrollCarousel(this.closest('.carousel-container'), -1)">‚Äπ</div>
                            <div class="carousel-btn next" onclick="event.stopPropagation(); scrollCarousel(this.closest('.carousel-container'), 1)">‚Ä∫</div>
                            <div class="carousel-dots">${dotsHtml}</div>
                        </div>
                    `;
                } else if (galleryImages && galleryImages.length === 1) {
                    mediaHtml = `<img src="${galleryImages[0]}" class="post-image-static" onclick="event.stopPropagation(); openModal('${galleryImages[0]}')" loading="lazy">`;
                } else {
                    mediaHtml = `<div style="width:100%; aspect-ratio:16/9; background:#2a2a2e; display:flex; align-items:center; justify-content:center; color:var(--text-secondary); border-bottom:1px solid var(--border-subtle);">üñºÔ∏è –ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>`;
                }

                html += `
                    <div class="feed-post" onclick="window.location.href='/minecraft/${post.project_type}.html#${post.project_type}/${post.slug}'">
                        <div class="post-header">
                            <img src="${iconUrl}" class="post-icon" alt="${escapeHtml(post.title)}" onerror="this.src='https://via.placeholder.com/48/2c2c30/a0a0a8?text=Mod'">
                            <div class="post-info">
                                <div class="post-title-row">
                                    <span class="post-title">${escapeHtml(post.title)}</span>
                                    <span class="post-type ${post.project_type}">${typeName}</span>
                                </div>
                                <div class="post-author">${escapeHtml(post.author || '–ù–µ–∏–∑–≤–µ—Å—Ç–µ–Ω')}</div>
                            </div>
                        </div>
                        
                        ${mediaHtml}

                        <div class="post-body">
                            <div class="post-description">${escapeHtml(description)}</div>
                            <div class="post-categories">
                                ${(post.categories || []).slice(0, 3).map(cat => `<span class="category-tag">${escapeHtml(cat)}</span>`).join('')}
                            </div>
                            <div class="post-date">${formatRelativeDate(post.date_created)}</div>
                        </div>

                        <div class="post-actions">
                            <button class="action-btn ${liked ? 'liked' : ''}" onclick="event.stopPropagation(); toggleLike(this, '${postId}')">
                                <svg viewBox="0 0 24 24">
                                    <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                                </svg>
                                <span class="likes-count">${formatNumber(post.follows)}</span>
                            </button>
                            <button class="action-btn" onclick="event.stopPropagation(); window.location.href='/minecraft/${post.project_type}.html#${post.project_type}/${post.slug}'">
                                <svg viewBox="0 0 24 24"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                                –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                            </button>
                        </div>
                    </div>
                `;
            }

            if (currentPage === 0) {
                feedEl.innerHTML = html;
            } else {
                feedEl.insertAdjacentHTML('beforeend', html);
            }

            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–∞—Ä—É—Å–µ–ª–∏: –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ DOM –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º dots
            posts.forEach(post => {
                const postId = `${post.project_type}_${post.slug}`;
                const container = document.getElementById(`carousel-${postId}`);
                if (container) setupCarousel(container);
            });
        }

        function escapeHtml(unsafe) {
            if (!unsafe) return '';
            return String(unsafe).replace(/[&<>"]/g, function(m) {
                if (m === '&') return '&amp;'; if (m === '<') return '&lt;'; if (m === '>') return '&gt;'; if (m === '"') return '&quot;';
                return m;
            });
        }

        // –ë–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞: –±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è
        window.addEventListener('scroll', () => {
            const scrollY = window.scrollY;
            const windowHeight = window.innerHeight;
            const documentHeight = document.documentElement.scrollHeight;
            // –°—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∑–∞ 400px –¥–æ –∫–æ–Ω—Ü–∞, –Ω–æ –µ—Å–ª–∏ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ ‚Äî —Ü–µ–ø–ª—è–µ–º—Å—è
            if (scrollY + windowHeight > documentHeight - 400) {
                loadMorePosts();
            }
        });

        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ç—Ä–∏–≥–≥–µ—Ä –Ω–∞ resize –∏ load
        window.addEventListener('resize', () => {
            const scrollY = window.scrollY;
            const windowHeight = window.innerHeight;
            const documentHeight = document.documentElement.scrollHeight;
            if (scrollY + windowHeight > documentHeight - 400) {
                loadMorePosts();
            }
        });

        document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeModal(); });

        // –°—Ç–∞—Ä—Ç
        loadMorePosts();
    </script>
</body>
</html>
