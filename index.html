<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deynik Minecraft</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif;
        }

        body {
            background-color: #0f0f11;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            padding: 2rem 1rem;
        }

        .container {
            max-width: 1400px;
            width: 100%;
            display: flex;
            gap: 2rem;
        }

        :root {
            --bg-body: #0f0f11;
            --bg-raised: #1c1c1f;
            --bg-button: #2c2c30;
            --bg-button-hover: #3a3a40;
            --bg-selected: #3b3b45;
            --text-contrast: #ffffff;
            --text-primary: #e0e0e0;
            --text-secondary: #a0a0a8;
            --text-brand: #fbbf24;
            --bg-brand: rgba(251, 191, 36, 0.15);
            --border-subtle: #2c2c32;
            --card-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
        }

        /* –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å */
        .sidebar {
            width: 260px;
            flex-shrink: 0;
            background-color: var(--bg-raised);
            border-radius: 1rem;
            border: 1px solid var(--border-subtle);
            padding: 1.5rem 1rem;
            height: fit-content;
            position: sticky;
            top: 2rem;
        }

        .sidebar-logo {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--text-contrast);
            margin-bottom: 2rem;
            padding-left: 0.5rem;
        }

        .sidebar-logo span {
            color: var(--text-brand);
        }

        .sidebar-menu {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-bottom: 2rem;
        }

        .sidebar-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem 1rem;
            border-radius: 0.75rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            font-size: 1rem;
            font-weight: 500;
        }

        .sidebar-item:hover {
            background-color: var(--bg-button);
            color: var(--text-contrast);
        }

        .sidebar-item.active {
            background-color: var(--bg-brand);
            color: var(--text-brand);
        }

        .sidebar-item svg {
            width: 1.5rem;
            height: 1.5rem;
            stroke: currentColor;
            fill: none;
        }

        .main-content {
            flex: 1;
            min-width: 0;
        }

        /* –ü–æ–∏—Å–∫ */
        .search-section {
            margin-bottom: 1.5rem;
        }

        .search-wrapper {
            position: relative;
            max-width: 600px;
        }

        .search-input {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 3rem;
            background-color: var(--bg-raised);
            border: 2px solid var(--border-subtle);
            border-radius: 9999px;
            color: var(--text-contrast);
            font-size: 1rem;
            transition: all 0.2s;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--text-brand);
        }

        .search-input::placeholder {
            color: var(--text-secondary);
            opacity: 0.8;
        }

        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            width: 1.25rem;
            height: 1.25rem;
            stroke: var(--text-secondary);
        }

        /* –§–∏–ª—å—Ç—Ä—ã */
        .filters-section {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            gap: 1rem;
        }

        .filter-group {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .custom-select {
            position: relative;
            min-width: 180px;
        }

        .select-btn {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 0.5rem;
            background-color: var(--bg-button);
            border: 1px solid var(--border-subtle);
            color: var(--text-secondary);
            font-weight: 600;
            font-size: 0.95rem;
            padding: 0.5rem 1rem;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: all 0.15s;
            width: 100%;
        }

        .select-btn:hover {
            background-color: var(--bg-button-hover);
            color: var(--text-contrast);
            border-color: var(--text-brand);
        }

        .select-btn svg {
            width: 1.25rem;
            height: 1.25rem;
            stroke: currentColor;
            transition: transform 0.2s;
        }

        .select-btn.open svg {
            transform: rotate(180deg);
        }

        .select-dropdown {
            position: absolute;
            top: calc(100% + 0.5rem);
            left: 0;
            right: 0;
            background-color: var(--bg-raised);
            border: 1px solid var(--border-subtle);
            border-radius: 0.75rem;
            box-shadow: var(--card-shadow);
            z-index: 100;
            display: none;
            overflow: hidden;
        }

        .select-dropdown.show {
            display: block;
        }

        .select-option {
            padding: 0.75rem 1rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.15s;
            font-weight: 500;
        }

        .select-option:hover {
            background-color: var(--bg-button-hover);
            color: var(--text-contrast);
        }

        .select-option.selected {
            background-color: var(--bg-brand);
            color: var(--text-brand);
        }

        /* –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–∞ */
        .translate-toggle {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            background-color: var(--bg-raised);
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            border: 1px solid var(--border-subtle);
            box-shadow: var(--card-shadow);
        }

        .toggle-label {
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 0.9rem;
            white-space: nowrap;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 48px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-button);
            transition: 0.2s;
            border-radius: 34px;
            border: 1px solid var(--border-subtle);
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 2px;
            background-color: var(--text-secondary);
            transition: 0.2s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--bg-brand);
            border-color: var(--text-brand);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(23px);
            background-color: var(--text-brand);
        }

        /* –°–µ—Ç–∫–∞ */
        .mods-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .mod-card {
            background-color: var(--bg-raised);
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: var(--card-shadow);
            transition: all 0.2s;
            cursor: pointer;
            border: 1px solid var(--border-subtle);
        }

        .mod-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.7);
            border-color: var(--text-brand);
        }

        .mod-header {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .mod-icon {
            width: 64px;
            height: 64px;
            border-radius: 12px;
            background-color: var(--bg-button);
            object-fit: cover;
        }

        .mod-title {
            flex: 1;
        }

        .mod-name {
            font-weight: 700;
            color: var(--text-contrast);
            font-size: 1.2rem;
            margin-bottom: 0.25rem;
        }

        .mod-author {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .mod-description {
            color: var(--text-primary);
            font-size: 0.95rem;
            line-height: 1.5;
            margin-bottom: 1rem;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .mod-stats {
            display: flex;
            gap: 1rem;
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .mod-stat {
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .mod-stat svg {
            width: 1rem;
            height: 1rem;
            stroke: currentColor;
            fill: none;
        }

        .mod-loaders {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .loader-badge {
            background-color: var(--bg-button);
            border: 1px solid var(--border-subtle);
            border-radius: 9999px;
            padding: 0.25rem 0.75rem;
            font-size: 0.8rem;
            color: var(--text-primary);
        }

        .loading {
            text-align: center;
            padding: 3rem;
            font-size: 1.2rem;
            grid-column: 1 / -1;
            color: var(--text-secondary);
        }

        .pagination {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 2rem;
            flex-wrap: wrap;
        }

        .page-btn {
            min-width: 2.5rem;
            height: 2.5rem;
            border-radius: 0.5rem;
            background: transparent;
            border: 1px solid var(--border-subtle);
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.1s;
            padding: 0 0.5rem;
        }

        .page-btn:hover:not(:disabled) {
            background-color: var(--bg-button);
            color: var(--text-contrast);
        }

        .page-btn.active {
            background-color: var(--bg-brand);
            color: var(--text-brand);
            border-color: var(--text-brand);
        }

        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
        <div class="sidebar">
            <div class="sidebar-logo" onclick="window.location.href='/minecraft/'">Deynik <span>Minecraft</span></div>
            
            <div class="sidebar-menu">
                <button class="sidebar-item active" onclick="window.location.href='/minecraft/'">
                    <svg viewBox="0 0 24 24"><path d="M3 10.5L12 3l9 7.5v9a1.5 1.5 0 0 1-1.5 1.5h-15A1.5 1.5 0 0 1 3 19.5v-9z"/><path d="M9 21v-6h6v6"/></svg>
                    –ì–ª–∞–≤–Ω–∞—è
                </button>
                <button class="sidebar-item" onclick="window.location.href='/minecraft/feed.html'">
                    <svg viewBox="0 0 24 24"><path d="M22 6.5L12 2 2 6.5M22 6.5L12 11 2 6.5M22 6.5V17M2 6.5V17M12 11v9"/><path d="M7 15l5 3 5-3"/></svg>
                    –õ–µ–Ω—Ç–∞
                </button>
            </div>

            <div class="sidebar-menu">
                <button class="sidebar-item" data-tab="mod">
                    <svg viewBox="0 0 24 24"><path d="M20 7h-4.5L15 4H9L8.5 7H4v2h16V7z"/><rect x="4" y="9" width="16" height="10" rx="1"/><circle cx="8" cy="13" r="1"/><circle cx="16" cy="13" r="1"/></svg>
                    –ú–æ–¥—ã
                </button>
                <button class="sidebar-item" data-tab="shader">
                    <svg viewBox="0 0 24 24"><path d="M12 3v1M5 8h1M18 8h1M8 21h8M12 8v8"/><circle cx="12" cy="15" r="3"/><path d="M8 11L5 8M16 11l3-3"/></svg>
                    –®–µ–π–¥–µ—Ä—ã
                </button>
                <button class="sidebar-item" data-tab="resourcepack">
                    <svg viewBox="0 0 24 24"><path d="M4 4h16v16H4z"/><path d="M9 9l6 6M15 9l-6 6"/></svg>
                    –†–µ—Å—É—Ä—Å–ø–∞–∫–∏
                </button>
                <button class="sidebar-item" data-tab="modpack">
                    <svg viewBox="0 0 24 24"><path d="M4 4h16v2H4z"/><rect x="4" y="8" width="16" height="12" rx="1"/><path d="M10 12l2 2 4-4"/></svg>
                    –°–±–æ—Ä–∫–∏
                </button>
                <button class="sidebar-item" data-tab="plugin">
                    <svg viewBox="0 0 24 24"><path d="M20 12v4a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-4"/><rect x="4" y="4" width="16" height="8" rx="1"/><circle cx="12" cy="12" r="2"/></svg>
                    –ü–ª–∞–≥–∏–Ω—ã
                </button>
                <button class="sidebar-item" data-tab="datapack">
                    <svg viewBox="0 0 24 24"><path d="M4 4h16v16H4z"/><path d="M8 8h8v8H8z"/><path d="M12 12l2-2-2-2"/></svg>
                    –î–∞—Ç–∞–ø–∞–∫–∏
                </button>
            </div>
        </div>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <div class="main-content">
            <!-- –ü–æ–∏—Å–∫ -->
            <div class="search-section">
                <div class="search-wrapper">
                    <svg class="search-icon" viewBox="0 0 24 24">
                        <path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                    </svg>
                    <input type="text" class="search-input" placeholder="üîç –ù–∞–π–¥–µ—Ç—Å—è –≤—Å—ë!" id="searchInput">
                </div>
            </div>

            <!-- –§–∏–ª—å—Ç—Ä—ã -->
            <div class="filters-section">
                <div class="filter-group">
                    <div class="custom-select" id="sortSelect">
                        <button class="select-btn" id="sortBtn">
                            <span id="sortText">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: –Ω–æ–≤—ã–µ</span>
                            <svg viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                        </button>
                        <div class="select-dropdown" id="sortDropdown">
                            <div class="select-option selected" data-value="newest">üî• –ù–æ–≤—ã–µ</div>
                            <div class="select-option" data-value="relevance">üéØ –†–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ</div>
                            <div class="select-option" data-value="downloads">üì• –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ</div>
                            <div class="select-option" data-value="updated">üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ</div>
                        </div>
                    </div>

                    <div class="custom-select" id="platformSelect">
                        <button class="select-btn" id="platformBtn">
                            <span id="platformText">–í—Å–µ –∑–∞–≥—Ä—É–∑—á–∏–∫–∏</span>
                            <svg viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>
                        </button>
                        <div class="select-dropdown" id="platformDropdown">
                            <div class="select-option selected" data-value="all">–í—Å–µ –∑–∞–≥—Ä—É–∑—á–∏–∫–∏</div>
                            <div class="select-option" data-value="fabric">Fabric</div>
                            <div class="select-option" data-value="forge">Forge</div>
                            <div class="select-option" data-value="neoforge">NeoForge</div>
                            <div class="select-option" data-value="quilt">Quilt</div>
                        </div>
                    </div>
                </div>
                
                <div class="translate-toggle">
                    <span class="toggle-label">üá∑üá∫ –†—É—Å—Å–∫–∏–π</span>
                    <label class="toggle-switch">
                        <input type="checkbox" id="translateToggle" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>

            <!-- –°–µ—Ç–∫–∞ -->
            <div id="modsGrid" class="mods-grid">
                <div class="loading">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...</div>
            </div>

            <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
            <div class="pagination" id="pagination"></div>
        </div>
    </div>

    <script>
        // ========== –ù–ê–°–¢–†–û–ô–ö–ò ==========
        const API_BASE = 'https://api.modrinth.com/v2';
        const TRANSLATE_API = 'https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=ru&dt=t&q=';

        // –°–æ—Å—Ç–æ—è–Ω–∏–µ
        let currentPage = 0;
        let currentTab = 'mod';
        let currentSearch = '';
        let currentPlatform = 'all';
        let currentSort = 'newest';
        let translateEnabled = true;
        let totalHits = 0;
        let cachedProjects = null;
        let cachedTranslations = new Map();
        const limit = 25;

        // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã
        const platforms = ['all', 'fabric', 'forge', 'neoforge', 'quilt'];
        const sorts = ['newest', 'relevance', 'downloads', 'updated'];
        const sortNames = {
            'newest': 'üî• –ù–æ–≤—ã–µ',
            'relevance': 'üéØ –†–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ',
            'downloads': 'üì• –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ',
            'updated': 'üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ'
        };

        // –≠–ª–µ–º–µ–Ω—Ç—ã
        const modsGrid = document.getElementById('modsGrid');
        const searchInput = document.getElementById('searchInput');
        const sidebarItems = document.querySelectorAll('.sidebar-item[data-tab]');
        const translateToggle = document.getElementById('translateToggle');
        const paginationEl = document.getElementById('pagination');

        // –≠–ª–µ–º–µ–Ω—Ç—ã —Å–µ–ª–µ–∫—Ç–æ–≤
        const sortSelect = document.getElementById('sortSelect');
        const sortBtn = document.getElementById('sortBtn');
        const sortText = document.getElementById('sortText');
        const sortDropdown = document.getElementById('sortDropdown');
        const sortOptions = sortDropdown.querySelectorAll('.select-option');

        const platformSelect = document.getElementById('platformSelect');
        const platformBtn = document.getElementById('platformBtn');
        const platformText = document.getElementById('platformText');
        const platformDropdown = document.getElementById('platformDropdown');
        const platformOptions = platformDropdown.querySelectorAll('.select-option');

        // ========== –ó–ê–ö–†–´–¢–ò–ï –î–†–û–ü–î–ê–£–ù–û–í ==========
        document.addEventListener('click', (e) => {
            if (!sortSelect.contains(e.target)) {
                sortBtn.classList.remove('open');
                sortDropdown.classList.remove('show');
            }
            if (!platformSelect.contains(e.target)) {
                platformBtn.classList.remove('open');
                platformDropdown.classList.remove('show');
            }
        });

        // ========== –°–û–†–¢–ò–†–û–í–ö–ê ==========
        sortBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            sortBtn.classList.toggle('open');
            sortDropdown.classList.toggle('show');
            platformDropdown.classList.remove('show');
            platformBtn.classList.remove('open');
        });

        sortOptions.forEach(option => {
            option.addEventListener('click', () => {
                const value = option.dataset.value;
                const text = option.textContent;
                
                sortOptions.forEach(opt => opt.classList.remove('selected'));
                option.classList.add('selected');
                sortText.textContent = `–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: ${text}`;
                currentSort = value;
                
                sortBtn.classList.remove('open');
                sortDropdown.classList.remove('show');
                
                currentPage = 0;
                loadMods();
            });
        });

        // ========== –ü–õ–ê–¢–§–û–†–ú–´ ==========
        platformBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            platformBtn.classList.toggle('open');
            platformDropdown.classList.toggle('show');
            sortDropdown.classList.remove('show');
            sortBtn.classList.remove('open');
        });

        platformOptions.forEach(option => {
            option.addEventListener('click', () => {
                const value = option.dataset.value;
                const text = option.textContent;
                
                platformOptions.forEach(opt => opt.classList.remove('selected'));
                option.classList.add('selected');
                platformText.textContent = text;
                currentPlatform = value;
                
                platformBtn.classList.remove('open');
                platformDropdown.classList.remove('show');
                
                currentPage = 0;
                loadMods();
            });
        });

        // ========== –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–ï –ü–ï–†–ï–í–û–î–ê ==========
        translateToggle.addEventListener('change', async () => {
            translateEnabled = translateToggle.checked;
            
            if (translateEnabled && cachedProjects) {
                modsGrid.innerHTML = '<div class="loading">üîÑ –ü–µ—Ä–µ–≤–æ–¥–∏–º –æ–ø–∏—Å–∞–Ω–∏—è...</div>';
                
                for (const project of cachedProjects) {
                    if (project.description && !cachedTranslations.has(project.description)) {
                        await translateText(project.description);
                    }
                }
            }
            
            renderProjects();
        });

        // ========== –ü–ï–†–ï–í–û–î ==========
        async function translateText(text) {
            if (!text || text.length < 10) return text;
            if (cachedTranslations.has(text)) return cachedTranslations.get(text);
            
            try {
                const response = await fetch(TRANSLATE_API + encodeURIComponent(text));
                const data = await response.json();
                const translated = data[0][0][0];
                cachedTranslations.set(text, translated);
                return translated;
            } catch (error) {
                console.warn('–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–≤–æ–¥–∞:', error);
                return text;
            }
        }

        // ========== –ü–û–õ–£–ß–ï–ù–ò–ï –û–ü–ò–°–ê–ù–ò–Ø ==========
        function getDescription(project) {
            if (!translateEnabled) {
                return project.description || 'No description available.';
            }
            
            const cached = cachedTranslations.get(project.description);
            return cached || project.description || '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è';
        }

        // ========== –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–ï –í–ö–õ–ê–î–û–ö ==========
        sidebarItems.forEach(item => {
            item.addEventListener('click', () => {
                sidebarItems.forEach(i => i.classList.remove('active'));
                item.classList.add('active');
                currentTab = item.dataset.tab;
                currentPage = 0;
                loadMods();
            });
        });

        // ========== –û–¢–†–ò–°–û–í–ö–ê ==========
        function renderProjects() {
            if (!cachedProjects || cachedProjects.length === 0) {
                modsGrid.innerHTML = '<div class="loading">üòï –ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>';
                return;
            }

            let html = '';
            for (const project of cachedProjects) {
                const description = getDescription(project);
                const iconUrl = project.icon_url || 'https://via.placeholder.com/64/2c2c30/a0a0a8?text=Mod';
                const updated = project.date_modified ? new Date(project.date_modified).toLocaleDateString('ru-RU') : '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
                
                html += `
                    <div class="mod-card" onclick="window.location.href='/minecraft/${project.project_type}.html#${project.project_type}/${project.slug}'">
                        <div class="mod-header">
                            <img src="${iconUrl}" class="mod-icon" alt="${escapeHtml(project.title)}"
                                 onerror="this.src='https://via.placeholder.com/64/2c2c30/a0a0a8?text=Mod'">
                            <div class="mod-title">
                                <div class="mod-name">${escapeHtml(project.title)}</div>
                                <div class="mod-author">by ${escapeHtml(project.author || '–ù–µ–∏–∑–≤–µ—Å—Ç–µ–Ω')}</div>
                            </div>
                        </div>
                        <div class="mod-description">${escapeHtml(description)}</div>
                        <div class="mod-stats">
                            <span class="mod-stat">
                                <svg viewBox="0 0 24 24"><path d="M4 16v1a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3v-1m-4-4-4 4m0 0-4-4m4 4V4"/></svg>
                                ${formatNumber(project.downloads)}
                            </span>
                            <span class="mod-stat">
                                <svg viewBox="0 0 24 24"><path d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2"/></svg>
                                ${formatRelativeDate(project.date_modified)}
                            </span>
                        </div>
                        <div class="mod-loaders">
                            ${(project.categories || []).slice(0, 4).map(l => 
                                `<span class="loader-badge">${escapeHtml(l)}</span>`
                            ).join('')}
                            ${(project.categories || []).length > 4 ? 
                                `<span class="loader-badge">+${project.categories.length - 4}</span>` : ''}
                        </div>
                    </div>
                `;
            }
            
            modsGrid.innerHTML = html;
        }

        // ========== –§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–ï –ß–ò–°–ï–õ ==========
        function formatNumber(num) {
            if (!num) return '0';
            if (num >= 1_000_000) return (num / 1_000_000).toFixed(1) + 'M';
            if (num >= 1_000) return (num / 1_000).toFixed(1) + 'k';
            return num.toString();
        }

        // ========== –§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–ï –î–ê–¢–´ ==========
        function formatRelativeDate(dateString) {
            if (!dateString) return '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
            const date = new Date(dateString);
            const now = new Date();
            const diffTime = Math.abs(now - date);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays < 7) {
                return `${diffDays} ${getDaysWord(diffDays)} –Ω–∞–∑–∞–¥`;
            } else if (diffDays < 30) {
                const weeks = Math.floor(diffDays / 7);
                return `${weeks} ${getWeeksWord(weeks)} –Ω–∞–∑–∞–¥`;
            } else if (diffDays < 365) {
                const months = Math.floor(diffDays / 30);
                return `${months} ${getMonthsWord(months)} –Ω–∞–∑–∞–¥`;
            } else {
                const years = Math.floor(diffDays / 365);
                return `${years} ${getYearsWord(years)} –Ω–∞–∑–∞–¥`;
            }
        }

        function getDaysWord(days) {
            if (days === 1) return '–¥–µ–Ω—å';
            if (days >= 2 && days <= 4) return '–¥–Ω—è';
            return '–¥–Ω–µ–π';
        }

        function getWeeksWord(weeks) {
            if (weeks === 1) return '–Ω–µ–¥–µ–ª—é';
            if (weeks >= 2 && weeks <= 4) return '–Ω–µ–¥–µ–ª–∏';
            return '–Ω–µ–¥–µ–ª—å';
        }

        function getMonthsWord(months) {
            if (months === 1) return '–º–µ—Å—è—Ü';
            if (months >= 2 && months <= 4) return '–º–µ—Å—è—Ü–∞';
            return '–º–µ—Å—è—Ü–µ–≤';
        }

        function getYearsWord(years) {
            if (years === 1) return '–≥–æ–¥';
            if (years >= 2 && years <= 4) return '–≥–æ–¥–∞';
            return '–ª–µ—Ç';
        }

        // ========== –ó–ê–ì–†–£–ó–ö–ê ==========
        async function loadMods() {
            try {
                modsGrid.innerHTML = '<div class="loading">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...</div>';

                const facetsArray = [[`project_type:${currentTab}`]];
                
                if (currentPlatform !== 'all') {
                    facetsArray.push([`categories:${currentPlatform}`]);
                }

                let url = `${API_BASE}/search?limit=${limit}&offset=${currentPage * limit}`;
                url += `&facets=${encodeURIComponent(JSON.stringify(facetsArray))}`;
                
                if (currentSearch.trim()) {
                    url += `&query=${encodeURIComponent(currentSearch.trim())}`;
                }
                
                url += `&index=${currentSort}`;

                const response = await fetch(url);
                if (!response.ok) throw new Error(`–û—à–∏–±–∫–∞ ${response.status}`);
                
                const data = await response.json();
                
                totalHits = data.total_hits;
                cachedProjects = data.hits;

                if (!cachedProjects || cachedProjects.length === 0) {
                    modsGrid.innerHTML = '<div class="loading">üòï –ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>';
                    return;
                }

                if (translateEnabled) {
                    modsGrid.innerHTML = '<div class="loading">üîÑ –ü–µ—Ä–µ–≤–æ–¥–∏–º –æ–ø–∏—Å–∞–Ω–∏—è...</div>';
                    
                    for (const project of cachedProjects) {
                        if (project.description && !cachedTranslations.has(project.description)) {
                            await translateText(project.description);
                        }
                    }
                }
                
                renderProjects();
                updatePagination();

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                modsGrid.innerHTML = `<div class="loading">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>`;
            }
        }

        // ========== –ü–ê–ì–ò–ù–ê–¶–ò–Ø ==========
        function updatePagination() {
            const totalPages = Math.ceil(totalHits / limit);
            paginationEl.innerHTML = '';

            if (totalPages <= 1) return;

            const prevBtn = document.createElement('button');
            prevBtn.className = 'page-btn';
            prevBtn.innerHTML = '‚Üê';
            prevBtn.disabled = currentPage === 0;
            prevBtn.onclick = () => {
                if (currentPage > 0) {
                    currentPage--;
                    loadMods();
                    window.scrollTo(0, 0);
                }
            };
            paginationEl.appendChild(prevBtn);

            let start = Math.max(0, currentPage - 2);
            let end = Math.min(totalPages, currentPage + 3);

            for (let i = start; i < end; i++) {
                const btn = document.createElement('button');
                btn.className = `page-btn ${i === currentPage ? 'active' : ''}`;
                btn.textContent = i + 1;
                btn.onclick = () => {
                    currentPage = i;
                    loadMods();
                    window.scrollTo(0, 0);
                };
                paginationEl.appendChild(btn);
            }

            const nextBtn = document.createElement('button');
            nextBtn.className = 'page-btn';
            nextBtn.innerHTML = '‚Üí';
            nextBtn.disabled = currentPage >= totalPages - 1;
            nextBtn.onclick = () => {
                if (currentPage < totalPages - 1) {
                    currentPage++;
                    loadMods();
                    window.scrollTo(0, 0);
                }
            };
            paginationEl.appendChild(nextBtn);
        }

        // ========== –ü–û–ò–°–ö ==========
        let searchTimeout;
        searchInput.addEventListener('input', () => {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                currentSearch = searchInput.value;
                currentPage = 0;
                if (currentSearch) {
                    currentSort = 'relevance';
                    sortText.textContent = `–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: ${sortNames.relevance}`;
                    sortOptions.forEach(opt => {
                        opt.classList.remove('selected');
                        if (opt.dataset.value === 'relevance') opt.classList.add('selected');
                    });
                }
                loadMods();
            }, 500);
        });

        // ========== –ó–ê–©–ò–¢–ê –û–¢ XSS ==========
        function escapeHtml(unsafe) {
            if (!unsafe) return '';
            return String(unsafe)
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        // ========== –°–¢–ê–†–¢ ==========
        // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∫–ª–∞–¥–∫—É "–ú–æ–¥—ã" –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        document.querySelector('.sidebar-item[data-tab="mod"]').classList.add('active');
        loadMods();

        // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞–∑ –≤ 5 –º–∏–Ω—É—Ç
        setInterval(loadMods, 5 * 60 * 1000);
    </script>
</body>
</html>
